<!DOCTYPE html>
<html lang="pt-BR">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<meta name="author" content="Gabriel D. N. Silva" />
		<meta name="description" content="Ranking de Operadoras - Atacadão" />
		<meta name="keywords" content="Atacadão, Ranking, Operadoras, PIX" />

		<!-- Icones -->
		<link
			rel="icon"
			type="image/x-icon"
			href="./assets/img/icons/fav-Icon.webp"
		/>

		<link
			href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css"
			rel="stylesheet"
		/>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
			crossorigin="anonymous"
		/>
		<link rel="stylesheet" href="./src/css/styles.css" />
		<link rel="stylesheet" href="./src/css/components/charts.css" />
		<title>Ranking PIX - Atacadão</title>
	</head>
	<body>
		<div class="page-wrapper">
			<aside class="sidebar">
				<div class="sidebar-header">
					<i class="ri-bar-chart-2-line"></i>
					<h2 class="sidebar-title">Ranking PIX</h2>
				</div>
				<nav class="sidebar-nav">
					<p class="nav-section-title mt-4">Início</p>
					<ul class="nav-list">
						<li>
							<a
								href="#"
								id="dashboard-link"
								class="nav-link"
								data-perm="view-reports"
							>
								<i class="ri-dashboard-line"></i>
								<span> Dashboard </span>
							</a>
						</li>
					</ul>

					<p class="nav-section-title" data-perm="upload-csv">
						Processar Dados
					</p>
					<ul
						class="nav-list"
						id="upload-section"
						data-perm="upload-csv"
					>
						<li>
							<label
								for="json-upload"
								class="nav-link"
								data-perm="manage-operators"
							>
								<i class="ri-database-2-line"></i
								><span>Substituir Operadoras</span></label
							>
							<input
								type="file"
								id="json-upload"
								accept=".json"
								hidden
							/>
						</li>
						<li>
							<label for="pix-upload" class="nav-link">
								<i class="ri-qr-code-line"></i>
								<span>Carregar Transações PIX</span>
							</label>
							<input
								type="file"
								id="pix-upload"
								accept=".csv"
								hidden
							/>
						</li>
						<li>
							<label for="debit-upload" class="nav-link">
								<i class="ri-bank-card-line"></i
								><span>Carregar Transações Débito</span>
							</label>
							<input
								type="file"
								id="debit-upload"
								accept=".csv"
								hidden
							/>
						</li>
						<p
							class="nav-section-title mt-4"
							data-perm="manage-operators"
						>
							Gerenciamento
						</p>
						<ul class="nav-list">
							<li>
								<a
									href="#"
									class="nav-link"
									id="manage-operators-link"
									data-perm="manage-operators"
								>
									<i class="ri-settings-3-line"></i
									><span>Gerenciar Operadoras</span></a
								>
							</li>
						</ul>
					</ul>
				</nav>
				<div class="sidebar-footer">
					<button
						class="btn"
						id="sidebar-toggle"
						title="Recolher Menu"
					>
						<i class="ri-menu-fold-line"></i>
					</button>
				</div>
			</aside>
			<div class="main-content">
				<header class="main-header">
					<div class="header-content">
						<h1>Ranking Operadoras</h1>
						<button id="logout-btn" class="btn btn-outline-danger">
							<i class="ri-logout-box-r-line"></i> Sair
						</button>
					</div>
				</header>

				<main class="container-fluid">
					<section id="ranking-view" class="view active-view">
						<div class="card shadow-sm">
							<div class="card-header">
								<h3>
									Ranking Geral de Operadoras por Transações
									PIX
								</h3>
							</div>
							<div class="card-body">
								<div class="row">
									<div class="col-md-6 mb-4">
										<canvas id="top3-chart"></canvas>
									</div>
									<div class="col-md-6 mb-4">
										<canvas
											id="top3-proportion-chart"
										></canvas>
									</div>
								</div>
								<p class="text-muted">
									Selecione os arquivos de transações na barra
									lateral para gerar o ranking
								</p>
								<div class="table-responsive">
									<table
										class="table table-hover align-middle"
									>
										<thead>
											<tr>
												<th>Posição</th>
												<th>Nome</th>
												<th>Nº Operadora</th>
												<th>Transações PIX</th>
												<th>Transações Débito</th>
												<th>Proporção PIX</th>
												<th>Ações</th>
											</tr>
										</thead>
										<tbody id="ranking-body"></tbody>
									</table>
								</div>
								<nav
									class="d-flex justify-content-end align-items-center mt-3"
								>
									<span
										id="page-info"
										class="me-3 text-muted"
									></span>
									<div class="btn-group">
										<button
											id="prev-page-btn"
											class="btn btn-outline-secondary"
										>
											<i class="ri-arrow-left-s-line"></i
											>Anterior
										</button>
										<button
											id="next-page-btn"
											class="btn btn-outline-secondary"
										>
											Próximo
											<i class="ri-arrow-right-s-line">
											</i>
										</button>
									</div>
								</nav>
								<div class="footer-dashboard-actions">
									<!-- Botão para exportar PDF -->
									<button
										id="export-ranking-pdf"
										class="btn btn-primary"
										disabled
									>
										<i class="ri-file-pdf-2-fill"></i>
										Exportar Ranking (PDF)
									</button>

									<!-- Botão para salvar relatórios-->
									<button
										id="save-report-btn"
										class="btn btn-success"
										data-perm="upload-csv"
										disabled
									>
										<i class="ri-save-3-line"></i>Salvar
										Relatório
									</button>
									<button
										id="open-saved-reports"
										class="btn btn-outline-secondary"
										data-perm="view-reports"
									>
										<i class="ri-history-line"></i>
										Relatórios Salvos
									</button>
								</div>
							</div>
						</div>
					</section>
					<section id="crud-view" class="view">
						<div class="card shadow-sm">
							<div
								class="card-header d-flex justify-content-between align-items-center"
							>
								<h3>Gerenciamento de Operadoras</h3>
								<button
									id="add-operator-btn"
									class="btn btn-success"
								>
									<i class="ri-add-line"></i> Adicionar
									Operadora
								</button>
							</div>
							<div class="card-body">
								<p class="text-muted">
									Adicione, edite ou remova operadoras. As
									alterações só serão salvas no servidor após
									clickar em "Salvar Alterações".
								</p>
								<div class="table-responsive">
									<table
										class="table table-hover align-middle"
									>
										<thead>
											<tr>
												<th>Nome da Operadora</th>
												<th>Nº da Operadora</th>
												<th class="text-end">Ações</th>
											</tr>
										</thead>
										<tbody id="crud-table-body"></tbody>
									</table>
								</div>
								<button
									id="save-changes-btn"
									class="btn btn-primary mt-3"
								>
									<i class="ri-save-3-line"></i>Salvar
									Alterações
								</button>
							</div>
						</div>
					</section>

					<section id="individual-view" class="view">
						<div class="card shadow-sm">
							<div
								class="card-header d-flex justify-content-between align-items-center"
							>
								<h3 id="individual-operator-name">
									Métricas Individuais
								</h3>
								<button
									id="back-to-ranking"
									class="btn btn-secondary"
								>
									<i class="ri-arrow-left-line"></i>
									Voltar ao Ranking
								</button>
							</div>
							<div class="card-body">
								<div class="row">
									<div class="col-md-5">
										<canvas id="metrics-chart"></canvas>
									</div>
									<div
										class="col-md-7"
										id="metrics-summary"
									></div>
								</div>
								<button
									id="export-individual-pdf"
									class="btn btn-primary mt-3"
								>
									<i class="ri-file-pdf-2-line"></i> Exportar
									Métricas Individuais (PDF)
								</button>
							</div>
						</div>
					</section>
				</main>
			</div>
		</div>
		<!-- Modal para adicionar operadora -->
		<div
			class="modal fade"
			id="operator-modal"
			tabindex="-1"
			aria-labelledby="operator-modal-label"
			aria-hidden="true"
		>
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="operator-modal-label">
							Adicionar Operadora
						</h5>
						<button
							type="button"
							class="btn-close"
							data-bs-dismiss="modal"
							aria-label="Close"
						></button>
					</div>

					<div class="modal-body">
						<form id="operator-form">
							<input type="hidden" id="operador-id-hidden" />
							<div class="mb-3">
								<label for="operator-name" class="form-label"
									>Nome da operadora</label
								>
								<input
									type="text"
									class="form-control"
									id="operator-name"
									required
								/>
							</div>
							<div class="mb-3">
								<label for="operator-number" class="form-label"
									>Nº da Operadora</label
								>
								<input
									type="number"
									class="form-control"
									id="operator-number"
									required
								/>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button
							type="button"
							class="btn btn-secondary"
							data-bs-dismiss="modal"
						>
							Cancelar
						</button>
						<button
							type="button"
							id="save-operator-form-btn"
							class="btn btn-primary"
						>
							Salvar
						</button>
					</div>
				</div>
			</div>
		</div>

		<!-- Modal para salvar relatório -->
		<div
			class="modal fade"
			id="saveReportModal"
			tabindex="-1"
			aria-labelledby="saveReportModalLabel"
			aria-hidden="true"
		>
			<div class="modal-dialog">
				<form id="save-report-form" class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="saveReportModalLabel">
							Salvar Relatório
						</h5>
						<button
							type="button"
							class="btn-close"
							data-bs-dismiss="modal"
							aria-label="Fechar"
						></button>
					</div>
					<div class="modal-body">
						<div class="mb-3">
							<label for="data-inicial" class="form-label"
								>Data Inicial</label
							>
							<input
								type="date"
								class="form-control"
								id="data-inicial"
								name="data_inicial"
								required
							/>
						</div>
						<div class="mb-3">
							<label for="data-final" class="form-label"
								>Data Final</label
							>
							<input
								type="date"
								class="form-control"
								id="data-final"
								name="data_final"
								required
							/>
						</div>
					</div>
					<div class="modal-footer">
						<button type="submit" class="btn btn-success">
							Confirmar
						</button>
						<button
							type="button"
							class="btn btn-secondary"
							data-bs-dismiss="modal"
						>
							Cancelar
						</button>
					</div>
				</form>
			</div>
		</div>

		<!-- Modal: Relatórios Salvos -->
		<div
			class="modal fade"
			id="savedReportsModal"
			tabindex="-1"
			aria-labelledby="savedReportsLabel"
			aria-hidden="true"
		>
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="savedReportsLabel">
							Relatórios Salvos
						</h5>
						<button
							type="button"
							class="btn-close"
							data-bs-dismiss="modal"
							aria-label="Fechar"
						></button>
					</div>
					<div class="modal-body">
						<div class="table-responsive">
							<table class="table table-sm align-middle">
								<thead>
									<tr>
										<th>ID</th>
										<th>Período</th>
										<th>Gerado em</th>
										<th>Por</th>
										<th>Ações</th>
									</tr>
								</thead>
								<tbody id="saved-reports-tbody">
									<tr>
										<td colspan="5" class="text-center">
											Carregando...
										</td>
									</tr>
								</tbody>
							</table>
						</div>
						<p class="text-muted mb-0">
							O sistema mantém apenas os 5 relatórios mais
							recentes.
						</p>
					</div>
					<div class="modal-footer">
						<button
							type="button"
							class="btn btn-secondary"
							data-bs-dismiss="modal"
						>
							Fechar
						</button>
					</div>
				</div>
			</div>
		</div>
		<script
			defer
			src="https://code.jquery.com/jquery-3.7.1.min.js"
			integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
			crossorigin="anonymous"
		></script>
		<script
			defer
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
			crossorigin="anonymous"
		></script>
		<script
			defer
			src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"
		></script>
		<script
			defer
			src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"
		></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
		<script
			defer
			src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"
		></script>
		<script
			defer
			src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"
		></script>
		<script
			defer
			src="https://cdn.jsdelivr.net/npm/sweetalert2@11"
		></script>
		<script type="module" src="./src/js/main.js"></script>
	</body>
</html>
